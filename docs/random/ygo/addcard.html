<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>TCG Collection Entry</title>
      <style>
         body {
         font-family: Arial, sans-serif;
         margin: 20px;
         background: #fdfdfd;
         }
         h1 {
         text-align: center;
         }
         /* show/hide utility */
         .hidden {
         display: none;
         }
         form {
         max-width: 600px;
         margin: 0 auto 20px;
         padding: 15px;
         border: 1px solid #ddd;
         border-radius: 4px;
         background: #fff;
         }
         label {
         display: block;
         margin-top: 10px;
         font-weight: bold;
         }
         input, select, textarea, datalist {
         width: 100%;
         padding: 6px;
         margin-top: 4px;
         box-sizing: border-box;
         }
         textarea {
         resize: vertical;
         height: 80px;
         }
         button {
         width: 100%;
         padding: 10px;
         margin-top: 15px;
         background: #0078d7;
         color: #fff;
         border: none;
         border-radius: 3px;
         cursor: pointer;
         }
         #csvOutput {
         display: block;        /* ← make it a block so margin:0 auto works */
         width: 100%;
         max-width: 600px;
         height: 150px;
         margin: 20px auto;     /* centered horizontally, with 20px top/bottom */
         padding: 10px;
         border: 1px solid #ccc;
         font-family: Consolas, monospace;
         }
         .top-controls {
         max-width: 600px;
         margin: 0 auto 20px;
         display: flex;
         justify-content: flex-end;
         align-items: center;
         }
         .top-controls label {
         margin-right: 10px;
         font-weight: normal;
         }
         /* undo the “width:100%” for checkboxes and keep them inline */
         input[type="checkbox"] {
         width: auto;
         display: inline-block;
         margin: 0 0.5em 0 0;    /* space between box and text */
         vertical-align: middle;
         }
      </style>
   </head>
   <body onload="init()">
      <h1>TCG Collection Entry</h1>
      <div class="top-controls">
         <label for="gameSelect">Game:</label>
         <select id="gameSelect" onchange="onGameChange()">
            <option value="ygo">Yu-Gi-Oh</option>
            <option value="pkm">Pokémon</option>
            <option value="vg">Cardfight Vanguard</option>
            <option value="digimon">Digimon</option>
         </select>
      </div>
      <form id="cardForm" autocomplete="off">
         <label for="name">Name:</label>
         <input type="text" id="name" required />
         <!-- YGO Type -->
         <div id="ygoTypeWrapper">
            <label for="ygo_type">Type:</label>
            <select id="ygo_type"></select>
         </div>
         <!-- Pokémon Stage + Type -->
         <div id="pkmTypeWrapper" class="hidden">
            <label for="pkm_stage">Stage:</label>
            <select id="pkm_stage"></select>
            <label for="pkm_type">Type:</label>
            <select id="pkm_type"></select>
         </div>
         <!-- Vanguard Card Type / Race / Clan / Grade -->
         <div id="vgTypeWrapper" class="hidden">
            <label for="vg_cardType">Card Type:</label>
            <select id="vg_cardType"></select>
            <label for="vg_race">Race:</label>
            <select id="vg_race"></select>
            <label for="vg_clan">Clan:</label>
            <select id="vg_clan"></select>
            <label for="vg_grade">Grade:</label>
            <select id="vg_grade">
               <option>Grade 0</option>
               <option>Grade 1</option>
               <option>Grade 2</option>
               <option>Grade 3</option>
               <option>Grade 4</option>
            </select>
         </div>
         <!-- Digimon Filters: Category, Form, Color, Trait + Rarity -->
         <div id="digimonFiltersWrapper" class="hidden">
            <label for="digimon_category">Category:</label>
            <select id="digimon_category"></select>
            <label for="digimon_form">Form:</label>
            <select id="digimon_form"></select>
            <label for="digimon_color">Color:</label>
            <select id="digimon_color"></select>
            <label for="digimon_trait">Trait:</label>
            <select id="digimon_trait"></select>
         </div>
         <!-- (Generic) RARITY for CSV export -->
         <label for="rarity">Rarity:</label>
         <select id="rarity"></select>
         <!-- QUALITY -->
         <label for="quality">Quality:</label>
         <select id="quality">
            <option>Near Mint</option>
            <option>Slightly Played</option>
            <option>Moderately Played</option>
            <option>Played</option>
            <option>Poor</option>
            <option>Unknown (good)</option>
            <option>Unknown (bad)</option>
         </select>
         <!-- LANGUAGE -->
         <label for="language">Language:</label>
         <select id="language">
            <option>IT</option>
            <option>EN</option>
            <option>JP</option>
            <option>DE</option>
            <option>FR</option>
            <option>ES</option>
         </select>
         <!-- EDITION TYPE -->
         <label for="editionType">Edition Type:</label>
         <select id="editionType">
            <option>First Edition</option>
            <option>Limited Edition</option>
            <option>Standard Edition</option>
         </select>
         <!-- PRICE PAID -->
         <label for="pricePaid">Price Paid:</label>
         <input type="number" id="pricePaid" step="0.01" />
         <!-- DYNAMIC ID LIST -->
         <label for="cardId">Card ID:</label>
         <input list="ids" id="cardId" />
         <datalist id="ids"></datalist>
         <!-- DATE -->
         <label for="specifyDate">
         <input type="checkbox" id="specifyDate" onchange="toggleDate()" />
         Specify date obtained
         </label>
         <div id="dateWrapper" class="hidden">
            <label for="dateObtained">Date Obtained:</label>
            <input type="date" id="dateObtained" />
         </div>
         <!-- LOCATION -->
         <label for="location">Location:</label>
         <input list="locations" id="location" />
         <datalist id="locations">
            <option value="Shelf">
            <option value="Binder">
            <option value="Deck Box">
            <option value="Box">
            <option value="Random">
            <option value="Unknown">
         </datalist>
         <!-- COMMENTS -->
         <label for="comments">Comments:</label>
         <textarea id="comments"></textarea>
         <button type="button" onclick="generateCSV()">Generate CSV Line</button>
      </form>
      <textarea
         id="csvOutput"
         readonly
         placeholder="CSV line will appear here…"
         ></textarea>
      <script>
         // ID lists loaded from TXT files
         const idLists = {
           ygo: [],
           pkm: [],
           vg: [],
           digimon: []
         };
         
         // Dynamic rarity options
         const rarityLists = {
           ygo: [
             'Common', 'Rare', 'Super Rare', 'Ultra Rare',
             'Secret Rare', 'Ghost Rare', "Collector's Rare",
             'Ultimate Rare', 'Unknown', 'Fake'
           ],
           pkm: [
             'Common', 'Uncommon', 'Rare', 'Holo Rare',
             'Ultra Rare', 'Secret Rare', 'Unknown'
           ],
           vg: [
             'Common', 'Rare', 'Double Rare', 'Triple Rare',
             'Special Parallel', 'Special Rare', 'Super Rare',
             'Unknown'
           ],
           digimon: [
             'Common', 'Uncommon', 'Rare',
             'Super Rare', 'Secret Rare',
             'Promo', 'Parallel Art'
           ]
         };
         
         // Updated dynamic type lists for all games
         const typeLists = {
           ygo: [
             "Monster (Vanilla)", "Monster (Effect)", "Monster (Ritual)",
             "Monster (Fusion)", "Monster (Synchro)", "Monster (XYZ)",
             "Monster (CXYZ)", "Monster (SXYZ)", "Monster (FXYZ)",
             "Monster (Pendulum)", "Monster (Link)", "Spell (Normal)",
             "Spell (Quick-Play)", "Spell (Continuous)", "Spell (Equip)",
             "Spell (Terrain)", "Trap (Normal)", "Trap (Continuous)",
             "Trap (Counter)", "Token"
           ],
         
           pkmStage: [
             "Pokémon - Base", "Pokémon - Stage 1",
             "Pokémon - Stage 2", "Pokémon - MEGA",
             "Energy", "Special Energy", "Supporter", "Trainer",
             "Item", "Stadium"
           ],
         
           pkmType: [
             "None", "Grass", "Fire", "Water",
             "Lightning", "Psychic", "Fighting",
             "Darkness", "Metal", "Dragon", "Fairy", "Colorless"
           ],
         
           vgCardType: [
             "Unit", "Trigger Unit", "G-Unit",
             "G-Guardian", "Order", "Token"
           ],
         
           vgRaces: [
             "Human", "Angel", "Demon", "Elf",
             "Succubus", "Vampire", "Dragoroid",
             "Mermaid", "Quintuplet", "Cyberoid",
             "Bioroid", "Warbeast", "Unknown"
           ],
         
           vgClans: [
             "Royal Paladin", "Kagero", "Aqua Force",
             "Shadow Paladin", "Genesis", "Gold Paladin",
             "Oracle Think Tank", "Dark Irregulars",
             "Narukami", "Bermuda Triangle", "Great Nature",
             "Neo Nectar", "Megacolony", "Granblue",
             "Dimension Police", "Spike Brothers",
             "Angel Feather", "Nubatama", "Link Joker",
             "Tachikaze", "Unknown"
           ],
         
           // Digimon-specific lists
           digiCategory: [
             'Digimon', 'Digi-Egg', 'Tamer',
             'Option', 'Token'
           ],
           digiForm: [
             'In-Training', 'Rookie',
             'Champion', 'Ultimate', 'Mega', 'Unknown'
           ],
           digiColor: [
             'Red', 'Blue', 'Yellow',
             'Green', 'Black', 'Purple', 'White', 'Unknown'
           ],
           digiTrait: [
             'CS', 'ACCEL', 'Unknown'
           ]
         };
         
         // Initialize: load ID files and setup UI
         async function init() {
           await Promise.all([
             loadIds('ygo'),
             loadIds('pkm'),
             loadIds('vg'),
             loadIds('digimon')
           ]);
           onGameChange();
         }
         
         // Fetch .txt file into idLists[game]
         async function loadIds(game) {
           const urlMap = {
             ygo: 'ygo_ids.txt',
             pkm: 'pkm_ids.txt',
             vg:  'vg_ids.txt',
             digimon: 'digimon_ids.txt'
           };
           try {
             const text = await fetch(urlMap[game]).then(r => r.text());
             idLists[game] = text.split(/\r?\n/).filter(l => l.trim());
           } catch (e) {
             console.warn(`Failed to load ${urlMap[game]}`, e);
           }
         }
         
         // When game changes: toggle fields, repopulate everything
         function onGameChange() {
           const game = document.getElementById('gameSelect').value;
         
           // show/hide wrappers
           document.getElementById('ygoTypeWrapper')
             .classList.toggle('hidden', game !== 'ygo');
           document.getElementById('pkmTypeWrapper')
             .classList.toggle('hidden', game !== 'pkm');
           document.getElementById('vgTypeWrapper')
             .classList.toggle('hidden', game !== 'vg');
           document.getElementById('digimonFiltersWrapper')
             .classList.toggle('hidden', game !== 'digimon');
         
           // fill rarities, IDs & types
           fillRarity(game);
           fillIds(game);
           fillTypeLists(game);
         
           // reset form & UI
           document.getElementById('cardForm').reset();
           document.getElementById('dateWrapper').classList.add('hidden');
           document.getElementById('csvOutput').value = '';
         }
         
         // Populate the Rarity dropdown (generic for CSV export)
         function fillRarity(game) {
           const sel = document.getElementById('rarity');
           sel.innerHTML = '';
           (rarityLists[game] || []).forEach(r => {
             const o = document.createElement('option');
             o.value = r;
             o.textContent = r;
             sel.appendChild(o);
           });
         }
         
         // Populate the Card ID datalist
         function fillIds(game) {
           const dl = document.getElementById('ids');
           dl.innerHTML = '';
           (idLists[game] || []).forEach(id => {
             const o = document.createElement('option');
             o.value = id.trim();
             dl.appendChild(o);
           });
         }
         
         // Populate the various <select> elements for each game
         function fillTypeLists(game) {
           const fill = (id, arr) => {
             const sel = document.getElementById(id);
             sel.innerHTML = '';
             arr.forEach(v => {
               const o = document.createElement('option');
               o.value = v;
               o.textContent = v;
               sel.appendChild(o);
             });
           };
         
           switch (game) {
             case 'ygo':
               fill('ygo_type', typeLists.ygo);
               break;
         
             case 'pkm':
               fill('pkm_stage', typeLists.pkmStage);
               fill('pkm_type',  typeLists.pkmType);
               break;
         
             case 'vg':
               fill('vg_cardType', typeLists.vgCardType);
               fill('vg_race',     typeLists.vgRaces);
               fill('vg_clan',     typeLists.vgClans);
               break;
         
             case 'digimon':
               fill('digimon_category', typeLists.digiCategory);
               fill('digimon_form',     typeLists.digiForm);
               fill('digimon_color',    typeLists.digiColor);
               fill('digimon_trait',    typeLists.digiTrait);
               break;
           }
         }
         
         // Show or hide the date picker
         function toggleDate() {
           document.getElementById('dateWrapper')
             .classList.toggle('hidden',
               !document.getElementById('specifyDate').checked);
         }
         
         // Helper to sanitize filenames
         function sanitizeFileName(str) {
           return str
             .normalize('NFD')
             .replace(/[\u0300-\u036f]/g, '')
             .replace(/[\/\\:"#?%*|<>]/g, '')
             .trim()
             .replace(/\s+/g, '_')
             .replace(/_+/g, '_');
         }
         
         // Build and display the 15-column CSV line
         function generateCSV() {
           const G = id => (document.getElementById(id).value || '').trim();
           const game = document.getElementById('gameSelect').value;
           const name = G('name') || 'Unknown';
         
           let category = 'Unknown';
           switch (game) {
             case 'ygo':
               category = G('ygo_type') || 'Unknown';
               break;
             case 'pkm':
               category = G('pkm_stage') || 'Unknown';
               if (category.includes('-')) {
                 category = category.replace('- ', '(') + '/';
               } else {
                 category += ' (';
               }
               category += (G('pkm_type') || 'Unknown').replace('None', 'Normal');
               if (category.includes('(')) category += ')';
               break;
             case 'vg':
               const ct = G('vg_cardType') || 'Unknown';
               const attrs = [ G('vg_race'), G('vg_clan'), G('vg_grade') ]
                 .filter(x => x && x !== 'Unknown');
               category = attrs.length ? `${ct}(${attrs.join('/')})` : ct;
               break;
             case 'digimon':
               // build Digimon category with optional trait appended
               const cat = G('digimon_category') || 'Unknown';
               const trait = G('digimon_trait');
               category = trait ? `${cat} (${trait})` : cat;
               break;
           }
         
           const rarity = G('rarity') || 'Unknown';
           const quality = G('quality') || 'Unknown';
           const lang = G('language') || 'Unknown';
           const edition = G('editionType') || 'Unknown';
           let price = 'Unknown';
           const p = parseFloat(G('pricePaid'));
           if (!isNaN(p)) price = p.toFixed(2);
         
           const cardId = (G('cardId').toUpperCase() || 'Unknown');
           const pack = cardId.includes('-') ? cardId.split('-')[0] : 'Unknown';
         
           let date = '24/10/2006';
           if (document.getElementById('specifyDate').checked) {
             const [yy, mm, dd] = G('dateObtained').split('-');
             date = `${dd}/${mm}/${yy}`;
           }
         
           const location = G('location') || 'Unknown';
           const comments = G('comments').replace(/\|/g, ' ') || '';
           const idForFile = sanitizeFileName(cardId);
         
           // Photo & wiki URLs
           let photo = '', wiki = '';
           switch (game) {
             case 'ygo':
               photo = `images/cards/yugioh/${lang}/${idForFile}.png`;
               wiki  = `https://yugipedia.com/wiki/${encodeURIComponent(cardId)}`;
               break;
             case 'pkm':
               photo = `images/cards/pokemon/${lang}/${idForFile}.png`;
               break;
             case 'vg':
               photo = `images/cards/vanguard/${lang}/${idForFile}.png`;
               const slug = sanitizeFileName(name);
               wiki = `https://cardfight.fandom.com/wiki/${slug}`;
               break;
             case 'digimon':
               photo = `images/cards/digimon/${lang}/${idForFile}.png`;
               wiki  = `https://digimoncardgame.fandom.com/wiki/${cardId}`;
               break;
           }
         
           const csv = [
             name, category, rarity, quality, lang,
             edition, price, '0.00', cardId, pack,
             date, location, comments, photo, wiki
           ].join('|');
         
           document.getElementById('csvOutput').value = csv;
         }
      </script>
   </body>
</html>
