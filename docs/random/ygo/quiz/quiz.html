<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Which Number Are You? â€” Editor with Reorder</title>
		<style>
			:root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;--accent:#0066cc;--muted:#8fa3bf}
			body{margin:0;padding:24px;background:linear-gradient(180deg,#071129,#041022);color:#e6eef8;min-height:100vh;display:flex;align-items:flex-start;justify-content:center}
			.wrap{width:100%;max-width:980px}
			.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
			header{display:flex;align-items:baseline;gap:12px;margin-bottom:12px}
			h1{margin:0;font-size:20px}
			.lead{color:var(--muted);font-size:13px;margin:0}
			.question{margin:10px 0;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.01)}
			.options{display:flex;flex-direction:column;gap:10px;margin-top:10px}
			.optRow{display:flex;gap:8px;align-items:center}
			.opt{flex:1;background:#071935;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;user-select:none;transition:transform .08s,opacity .12s}
			.opt:hover{transform:translateY(-3px)}
			.opt.chosen{outline:3px solid rgba(0,130,230,0.12);background:linear-gradient(0deg,rgba(0,110,210,0.08),rgba(0,80,160,0.04))}
			.metaBtn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe8ff;padding:8px;border-radius:8px;cursor:pointer}
			.controls{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
			.small{font-size:13px;color:var(--muted)}
			.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px}
			.modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;z-index:60}
			.modalCard{width:100%;max-width:760px;background:#071129;border-radius:10px;padding:18px;border:1px solid rgba(255,255,255,0.04)}
			.resultList{max-height:260px;overflow:auto;border-top:1px dashed rgba(255,255,255,0.03);margin-top:12px;padding-top:12px}
			.resultItem{display:flex;align-items:center;gap:10px;padding:6px;border-radius:6px}
			.resultItem label{cursor:pointer}
			.editorFooter{margin-top:12px;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.03)}
			.draggableList{display:flex;flex-direction:column;gap:8px}
			.draggableQ{display:flex;gap:10px;align-items:center;padding:10px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
			.dragHandle{width:20px;height:28px;background:rgba(255,255,255,0.02);border-radius:6px;display:flex;align-items:center;justify-content:center;color:var(--muted);cursor:grab;user-select:none}
			.dragHandle:active{cursor:grabbing}
			.possibleList{margin-top:10px;display:flex;flex-direction:column;gap:6px}
			.resultCardCompact{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.01)}
			@media(max-width:820px){.grid{grid-template-columns:1fr}.card{padding:14px}}
		</style>
	</head>
	<body>
		<div class="wrap">
			<div class="card" role="main" aria-labelledby="title">
				<header>
					<h1 id="title">Which Yu-Gi-Oh Number Are You?</h1>
					<div class="small" id="modeHint">Mode: <strong id="modeLabel"></strong></div>
				</header>
				<div id="quizArea" aria-live="polite"></div>
				<div class="controls" id="nav" style="display:none">
					<!-- intentionally empty: no Next/Prev to avoid manual flow -->
				</div>
				<div class="small" style="margin-top:10px">Progress: <span id="progressText">0 / 0</span></div>
				<div id="resultArea" style="display:none;margin-top:12px">
					<div class="resultCardCompact" id="resultCard"></div>
					<div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
						<div class="small" id="resultNote"></div>
					</div>
				</div>
				<div id="editorPanel" style="margin-top:14px;display:none">
					<div class="editorFooter">
						<h4 class="small">Possible Numbers (live)</h4>
						<div id="possibleList" class="possibleList"></div>
					</div>
				</div>
			</div>
		</div>
		<!-- modal for editing excludes -->
		<div id="modal" class="modal" style="display:none">
			<div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
				<h3 id="modalTitle">Edit Excludes for Option</h3>
				<div class="small" id="modalSubtitle" style="margin-bottom:10px">Check Number IDs this option excludes</div>
				<div class="resultList" id="resultList"></div>
				<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
					<button id="modalSave" class="metaBtn">Save</button>
					<button id="modalCancel" class="metaBtn">Cancel</button>
				</div>
			</div>
		</div>
		<script>
			/* Toggle: true shows editor controls (you), false hides them (player) */
			const EDIT_MODE = false; // set false for player-only mode (players won't see editor or reorder)

			/* RESULTS: expand to all 107 by adding entries. Only id + title kept. */
			const RESULTS = [
				//{ id: "1", 		title: "Number 1: Numeron Gate Ekam" },
				{ id: "1B", 	title: "Number 1: Infection Buzzking" },
				//{ id: "2", 		title: "Number 2: Numeron Gate Dve" },
				{ id: "2B", 	title: "Number 2: Ninja Shadow Mosquito" },
				//{ id: "3", 		title: "Number 3: Numeron Gate Trini" },
				{ id: "3B", 	title: "Number 3: Cicada King" },
				//{ id: "4", 		title: "Number 4: Numeron Gate Catvari" },
				{ id: "4B", 	title: "Number 4: Stealth Kragen" },
				{ id: "5", 		title: "Number 5: Doom Chimera Dragon" },
				{ id: "6", 		title: "Number 6: Chronomaly Atlandis" },
				{ id: "7", 		title: "Number 7: Lucky Straight" },
				{ id: "8", 		title: "Number 8: Heraldic King Genom-Heritage" },
				{ id: "9", 		title: "Number 9: Dyson Sphere" },
				{ id: "10", 	title: "Number 10: Illumiknight" },
				{ id: "11", 	title: "Number 11: Big Eye" },
				{ id: "12", 	title: "Number 12: Crimson Shadow Armor Ninja" },
				{ id: "13", 	title: "Number 13: Embodiment of Crime" },
				{ id: "14", 	title: "Number 14: Greedy Sarameya" },
				{ id: "15", 	title: "Number 15: Gimmick Puppet Giant Grinder" },
				{ id: "16", 	title: "Number 16: Shock Master" },
				{ id: "17", 	title: "Number 17: Leviathan Dragon" },
				{ id: "18", 	title: "Number 18: Heraldry Patriarch" },
				{ id: "19", 	title: "Number 19: Freezadon" },
				{ id: "20", 	title: "Number 20: Giga-Brilliant" },
				{ id: "21", 	title: "Number 21: Frozen Lady Justice" },
				{ id: "22", 	title: "Number 22: Zombiestein" },
				{ id: "23", 	title: "Number 23: Lancelot, Dark Knight of the Underworld" },
				{ id: "24", 	title: "Number 24: Dragulas the Vampiric Dragon" },
				{ id: "25", 	title: "Number 25: Force Focus" },
				{ id: "26", 	title: "Number 26: Spaceway Octobypass" },
				{ id: "27", 	title: "Number 27: Dreadnought Dreadnoid" },
				{ id: "28", 	title: "Number 28: Titanic Moth" },
				{ id: "29", 	title: "Number 29: Mannequin Cat" },
				{ id: "30", 	title: "Number 30: Acid Golem of Destruction" },
				{ id: "31", 	title: "Number 31: Embodiment of Punishment" },
				{ id: "32", 	title: "Number 32: Shark Drake" },
				{ id: "33", 	title: "Number 33: Chronomaly Machu Mech" },
				{ id: "34", 	title: "Number 34: Terror-Byte" },
				{ id: "35", 	title: "Number 35: Ravenous Tarantula" },
				{ id: "36", 	title: "Number 36: Chronomaly Chateau Huyuk" },
				{ id: "37", 	title: "Number 37: Hope Woven Dragon Spider Shark" },
				{ id: "38", 	title: "Number 38: Hope Harbinger Dragon Titanic Galaxy" },
				{ id: "39", 	title: "Number 39: Utopia" },
				{ id: "40", 	title: "Number 40: Gimmick Puppet of Strings" },
				{ id: "41", 	title: "Number 41: Bagooska the Terribly Tired Tapir" },
				{ id: "42", 	title: "Number 42: Galaxy Tomahawk" },
				{ id: "43", 	title: "Number 43: Manipulator of Souls" },
				{ id: "44", 	title: "Number 44: Sky Pegasus" },
				{ id: "45", 	title: "Number 45: Crumble Logos the Prophet of Demolition" },
				{ id: "46", 	title: "Number 46: Dragluon" },
				{ id: "47", 	title: "Number 47: Nightmare Shark" },
				{ id: "48", 	title: "Number 48: Shadow Lich" },
				{ id: "49", 	title: "Number 49: Fortune Tune" },
				{ id: "50", 	title: "Number 50: Blackship of Corn" },
				{ id: "51", 	title: "Number 51: Finisher the Strong Arm" },
				{ id: "52", 	title: "Number 52: Diamond Crab King" },
				{ id: "53", 	title: "Number 53: Heart-eartH" },
				{ id: "54", 	title: "Number 54: Lion Heart" },
				{ id: "55", 	title: "Number 55: Gogogo Goliath" },
				{ id: "56", 	title: "Number 56: Gold Rat" },
				{ id: "57", 	title: "Number 57: Tri-Head Dust Dragon" },
				{ id: "58", 	title: "Number 58: Burner Visor" },
				{ id: "59", 	title: "Number 59: Crooked Cook" },
				{ id: "60", 	title: "Number 60: Dugares the Timeless" },
				{ id: "61", 	title: "Number 61: Volcasaurus" },
				{ id: "62", 	title: "Number 62: Galaxy-Eyes Prime Photon Dragon" },
				{ id: "63", 	title: "Number 63: Shamoji Soldier" },
				{ id: "64", 	title: "Number 64: Ronin Raccoon Sandayu" },
				{ id: "65", 	title: "Number 65: Djinn Buster" },
				{ id: "66", 	title: "Number 66: Master Key Beetle" },
				{ id: "67", 	title: "Number 67: Pair-a-Dice Smasher" },
				{ id: "68", 	title: "Number 68: Sanaphond the Sky Prison" },
				{ id: "69", 	title: "Number 69: Heraldry Crest" },
				{ id: "70", 	title: "Number 70: Malevolent Sin" },
				{ id: "71", 	title: "Number 71: Rebarian Shark" },
				{ id: "72", 	title: "Number 72: Shogi Rook" },
				{ id: "73", 	title: "Number 73: Abyss Splash" },
				{ id: "74", 	title: "Number 74: Master of Blades" },
				{ id: "75", 	title: "Number 75: Bamboozling Gossip Shadow" },
				{ id: "76", 	title: "Number 76: Harmonizer Gradielle" },
				{ id: "77", 	title: "Number 77: The Seven Sins" },
				{ id: "78", 	title: "Number 78: Number Archive" },
				{ id: "79", 	title: "Number 79: Battlin' Boxer Nova Kaiser" },
				{ id: "80", 	title: "Number 80: Rhapsody in Berserk" },
				{ id: "81", 	title: "Number 81: Superdreadnought Rail Cannon Super Dora" },
				{ id: "82", 	title: "Number 82: Heartlandraco" },
				{ id: "83", 	title: "Number 83: Galaxy Queen" },
				{ id: "84", 	title: "Number 84: Pain Gainer" },
				{ id: "85", 	title: "Number 85: Crazy Box" },
				{ id: "86", 	title: "Number 86: Heroic Champion â€” Rhongomyniad" },
				{ id: "87", 	title: "Number 87: Queen of the Night" },
				{ id: "88", 	title: "Number 88: Gimmick Puppet of Leo" },
				{ id: "89", 	title: "Number 89: Diablosis the Mind Hacker" },
				{ id: "90", 	title: "Number 90: Galaxy-Eyes Photon Lord" },
				{ id: "91", 	title: "Number 91: Thunder Spark Dragon" },
				{ id: "92", 	title: "Number 92: Heart-eartH Dragon" },
				{ id: "93", 	title: "Number 93: Utopia Kaiser" },
				{ id: "94", 	title: "Number 94: Crystalzero" },
				{ id: "95", 	title: "Number 95: Galaxy-Eyes Dark Matter Dragon" },
				{ id: "96", 	title: "Number 96: Dark Mist" },
				{ id: "97", 	title: "Number 97: Draglubion" },
				{ id: "98", 	title: "Number 98: Antitopian" },
				{ id: "99", 	title: "Number 99: Utopia Dragonar" },
				{ id: "100", 	title: "Number 100: Numeron Dragon" },
				{ id: "101", 	title: "Number 101: Silent Honor ARK" },
				{ id: "102", 	title: "Number 102: Star Seraph Sentry" },
				{ id: "103", 	title: "Number 103: Ragnazero" },
				{ id: "104", 	title: "Number 104: Masquerade" },
				{ id: "105", 	title: "Number 105: Battlin' Boxer Star Cestus" },
				{ id: "106", 	title: "Number 106: Giant Hand" },
				{ id: "107", 	title: "Number 107: Galaxy-Eyes Tachyon Dragon" }
			];

			/* QUESTIONS: include numeric ord property for ordering.
			   options.excludes is an array of RESULT ids (strings).
			   Change ord values in code to reorder ask order.
			*/
			let QUESTIONS = [{
					ord: 0,
					text: "What is your favourite attribute?",
					options: [
						{ text: "LIGHT", excludes: ["1B", "2", "3", "4", "5", "11", "12", "13", "14", "15", "17", "19", "21", "22", "23", "24", "27", "28", "30", "31", "32", "34", "35", "37", "40", "41", "42", "43", "45", "47", "48", "50", "51", "52", "53", "54", "55", "57", "58", "59", "60", "61", "64", "65", "66", "68", "70", "71", "72", "73", "74", "75", "77", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "92", "94", "95", "96", "97", "98", "101", "103", "105", "106"] },
						{ text: "DARK", excludes: ["1", "2", "2B", "3", "3B", "4", "4B", "6", "7", "8", "9", "10", "12", "16", "17", "18", "19", "20", "21", "25", "26", "27", "28", "29", "30", "32", "33", "36", "37", "38", "39", "41", "42", "44", "45", "46", "47", "49", "51", "52", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "67", "69", "71", "72", "73", "74", "75", "76", "78", "79", "81", "82", "87", "90", "91", "93", "94", "99", "100", "101", "102", "103", "104", "105", "106", "107"] },
						{ text: "WATER", excludes: ["1", "1B", "2", "2B", "3B", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "18", "20", "22", "23", "24", "25", "26", "28", "29", "31", "33", "34", "35", "36", "38", "39", "40", "41", "42", "43", "44", "45", "46", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "72", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "88", "89", "90", "91", "92", "93", "95", "96", "97", "98", "99", "100", "102", "104", "105", "106", "107"] },
						{ text: "FIRE", excludes: ["1", "1B", "2", "2B", "3", "3B", "4", "4B", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "106", "107"] },
						{ text: "WIND", excludes: ["1", "1B", "2", "3", "4B", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "106", "107"] },
						{ text: "EARTH", excludes: ["1", "1B", "2", "2B", "3", "3B", "4B", "4", "5", "6", "7", "8", "9", "10", "11", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "42", "43", "44", "46", "47", "48", "49", "50", "53", "56", "57", "58", "59", "60", "61", "62", "63", "65", "66", "67", "68", "69", "70", "71", "73", "75", "76", "77", "78", "79", "80", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "107"] },
					]
				},
				{
					ord: 1,
					text: "Pick a playstyle you prefer",
					options: [
						{ text: "Control and manipulation", excludes: ["1", "2", "3", "4", "10", "17", "19", "20", "22", "27", "30", "39", "50", "52", "53", "56", "61", "78", "85", "91", "92", "93", "94", "102", "103", "104"] },
						{ text: "Aggressive beatdown", excludes: ["7", "10", "11", "13", "16", "19", "31", "34", "39", "40", "42", "60", "67", "78", "85", "88", "96", "103"] },
						{ text: "Tricksy disruption", excludes: ["1", "2", "3", "3B", "4", "10", "11", "16", "20", "22", "30", "34", "39", "40", "41", "50", "53", "56", "61", "69", "78", "88", "91", "92", "93", "96", "102", "107"] },
						{ text: "Balanced and dependable", excludes: ["11", "13", "16", "22", "30", "31", "41", "50", "61", "67", "69", "85", "88", "91", "96", "104"] },
						{ text: "None of these", excludes: [] }
					]
				},
				{
					ord: 2,
					text: "Which creature type are you most drawn to?",
					options: [
						{ text: "Dragons", excludes: ["1B", "1", "2B", "2", "3B", "3", "4B", "4", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "18", "19", "20", "21", "22", "23", "25", "26", "27", "28", "29", "30", "31", "33", "34", "35", "36", "39", "40", "41", "42", "43", "44", "45", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "61", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "83", "84", "85", "86", "87", "88", "89", "93", "94", "96", "98", "101", "102", "103", "104", "105", "106"] },
						{ text: "Fish / Sea", excludes: ["1B", "1", "2B", "2", "3B", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "18", "20", "22", "23", "24", "25", "28", "29", "31", "33", "34", "35", "36", "38", "39", "40", "41", "42", "43", "44", "45", "46", "48", "49", "51", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "72", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "92", "93", "95", "96", "97", "98", "99", "100", "102", "104", "105", "106", "107"] },
						{ text: "Dinosaurs / Beasts", excludes: ["1", "2", "3", "4", "6", "7", "9", "11", "13", "15", "17", "19", "21", "22", "23", "24", "25", "27", "31", "32", "33", "34", "36", "37", "38", "39", "40", "42", "43", "45", "46", "47", "48", "50", "51", "53", "57", "58", "59", "60", "61", "62", "63", "65", "67", "68", "69", "71", "72", "73", "74", "75", "76", "78", "79", "81", "82", "83", "85", "86", "87", "88", "89", "90", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "107"] },
						{ text: "Magical beings", excludes: ["1B", "2B", "3B", "4B", "5", "8", "14", "17", "18", "19", "21", "24", "26", "27", "28", "32", "35", "37", "38", "41", "44", "46", "47", "50", "52", "54", "55", "57", "61", "62", "64", "71", "73", "77", "82", "84", "91", "92", "94", "95", "97", "99", "100", "101", "106", "107"] },
						{ text: "None of these", excludes: [] }
					]
				},
				{
					ord: 3,
					text: "Which color aesthetic appeals to you most?",
					options: [
						{ text: "Light heroic", excludes: ["1", "1B", "2B", "2", "3", "3B", "4B", "4", "6", "9", "12", "13", "15", "16", "22", "23", "24", "25", "27", "29", "30", "31", "33", "34", "35", "36", "40", "43", "45", "47", "48", "50", "53", "55", "56", "59", "62", "64", "68", "69", "70", "75", "77", "78", "80", "81", "84", "85", "88", "89", "90", "92", "95", "96", "98", "104", "107"] },
						{ text: "Dark cosmic", excludes: ["1", "2", "3", "4", "7", "9", "10", "16", "21", "29", "33", "34", "36", "37", "38", "39", "41", "44", "49", "52", "54", "55", "56", "63", "74", "76", "79", "82", "93", "100", "101", "102", "105"] },
						{ text: "Natural earthy", excludes: ["1", "2", "3", "4", "6", "7", "9", "10", "11", "12", "13", "15", "16", "20", "21", "22", "23", "24", "25", "27", "30", "31", "33", "35", "36", "37", "38", "39", "42", "43", "44", "45", "48", "50", "53", "55", "62", "68", "69", "75", "76", "78", "81", "85", "88", "90", "93", "95", "96", "101", "103", "104", "105", "106", "107"] },
						{ text: "Industrial machine", excludes: ["1B", "2B", "3B", "4B", "5", "7", "8", "10", "12", "14", "17", "18", "19", "20", "21", "22", "23", "24", "26", "28", "29", "30", "31", "32", "35", "37", "38", "39", "41", "43", "44", "45", "46", "47", "48", "49", "51", "52", "54", "56", "57", "59", "60", "61", "62", "63", "64", "65", "66", "67", "69", "70", "71", "72", "73", "74", "75", "76", "77", "79", "80", "82", "83", "84", "86", "87", "89", "90", "91", "93", "94", "95", "96", "97", "98", "99", "100", "102", "103", "104", "105", "107"] },
						{ text: "None of these", excludes: [] }
					]
				},
				{
					ord: 4,
					text: "Which rank do you feel most comfortable with?",
					options: [
						{ text: "Rank 3 or lower", excludes: ["1B", "4B", "5", "6", "7", "8", "9", "10", "11", "12", "14", "15", "16", "18", "19", "21", "22", "23", "24", "25", "27", "28", "32", "33", "35", "36", "37", "38", "39", "40", "41", "42", "44", "46", "50", "52", "53", "55", "57", "58", "59", "60", "61", "62", "66", "67", "68", "69", "70", "72", "73", "74", "76", "77", "79", "80", "81", "82", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "97", "98", "99", "101", "102", "103", "104", "105", "106", "107"] },
						{ text: "Rank 4", excludes: ["1", "1B", "2", "2B", "3", "3B", "4", "5", "6", "7", "9", "11", "13", "14", "15", "17", "19", "20", "21", "22", "23", "24", "25", "26", "29", "30", "31", "33", "34", "35", "38", "40", "42", "43", "45", "46", "47", "48", "51", "53", "54", "56", "61", "62", "63", "64", "65", "68", "71", "72", "73", "74", "75", "76", "77", "78", "81", "83", "84", "87", "88", "89", "90", "92", "93", "94", "95", "96", "97", "99", "100", "107"] },
						{ text: "Rank 5 through 7", excludes: ["1", "2", "2B", "3", "3B", "4", "4B", "8", "9", "10", "12", "13", "15", "16", "17", "18", "20", "22", "23", "26", "27", "28", "29", "30", "31", "32", "34", "35", "36", "37", "39", "40", "41", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "54", "55", "56", "57", "58", "59", "60", "62", "63", "64", "65", "66", "68", "69", "70", "71", "75", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "90", "91", "92", "93", "95", "96", "97", "99", "101", "102", "103", "104", "105", "106", "107"] },
						{ text: "Rank 8 or higher", excludes: ["1", "2B", "2", "3B", "3", "4B", "4", "5", "7", "8", "10", "11", "12", "13", "14", "16", "17", "18", "19", "20", "21", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "36", "37", "39", "41", "42", "43", "44", "45", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "63", "64", "65", "66", "67", "69", "70", "71", "72", "73", "74", "75", "76", "78", "79", "80", "82", "83", "85", "86", "89", "91", "94", "96", "98", "100", "101", "102", "103", "104", "105", "106"] }
					]
				},
				{
					ord: 5,
					text: "Do you prefer humanoid monsters?",
					options: [
						{ text: "Yes, I do", excludes: ["1", "2", "2B", "3", "3B", "4", "4B", "5", "8", "9", "11", "13", "14", "16", "17", "18", "20", "24", "25", "26", "27", "28", "31", "32", "33", "34", "35", "36", "37", "38", "41", "42", "44", "46", "47", "49", "50", "52", "53", "56", "57", "58", "66", "68", "69", "70", "71", "72", "77", "78", "81", "82", "84", "85", "91", "92", "95", "97", "100", "101", "106", "107"] },
						{ text: "No, I don't", excludes: ["1B", "6", "7", "10", "12", "15", "19", "21", "22", "23", "29", "30", "39", "40", "43", "45", "48", "50", "54", "55", "59", "60", "61", "62", "64", "67", "73", "74", "75", "76", "79", "80", "83", "86", "87", "88", "89", "90", "93", "94", "96", "98", "99", "102", "103", "104", "105"] }
					]
				},
				{
					ord: 6,
					text: "If you could have a superpower, what would it be?",
					options: [
						// Removes stealth/flip/ambush style Numbers (notably: 4B â€” Number 4: Stealth Kragen; example effect: resurrecting from the graveyard)
						{ text: "Resurrect from the graveyard and return lost allies", excludes: ["8", "13", "17", "18", "20", "21", "30", "31", "32", "39", "42", "44", "47", "49", "52", "69", "71", "83", "84", "91", "95", "97"] },

						// Removes Heraldry family / heraldic priests, kings, and crest (notably: 8 â€” Heraldic King Genom-Heritage; 18 â€” Heraldry Patriarch; 69 â€” Heraldry Crest)
						{ text: "Command or empower heraldic priests and crests", excludes: ["3B", "4B", "7", "13", "16", "17", "20", "21", "24", "29", "31", "37", "39", "42", "44", "49", "52", "60", "62", "71", "79", "83", "84", "91", "92", "97", "98"] },

						// Removes stun/lock and Chronomaly machine lockdowns (notably: 16 â€” Shock Master; 36 â€” Chronomaly Chateau Huyuk)
						{ text: "Create field lockdowns and stun effects", excludes: ["3B", "4B", "7", "8", "11", "16", "17", "18", "20", "21", "24", "29", "36", "37", "39", "42", "44", "49", "52", "60", "62", "67", "69", "71", "79", "83", "84", "91", "92", "97", "98"] },

						// Removes tiny flyers and token/flyer chip strategies (notably: 44 â€” Sky Pegasus; 49 â€” Fortune Tune)
						{ text: "Summon tiny evasive flyers and swarm tokens", excludes: ["3B", "4B", "7", "8", "13", "16", "17", "18", "20", "21", "24", "29", "31", "36", "37", "39", "52", "60", "62", "69", "71", "79", "83", "84", "91", "92", "97", "98"] },

						{ text: "Supernatural strength", excludes: ["3B", "4B", "7", "8", "13", "16", "18", "20", "24", "29", "31", "36", "37", "39", "42", "44", "49", "52", "60", "62", "69", "71", "79", "83", "92", "97", "98"] },

						{ text: "Protect your allies", excludes: ["3B", "4B", "7", "8", "11", "13", "16", "17", "18", "20", "21", "24", "29", "30", "31", "32", "36", "37", "42", "44", "46", "47", "49", "60", "62", "67", "69", "71", "79", "84", "91", "92", "97", "98", "107"] },

						// Neutral â€” keep all Numbers
						{ text: "No superpower", excludes: [] }
					]
				},

				{
					ord: 7,
					text: "Can your monster evolve further or is it already perfect?",
					options: [
						// Removes evolvable/upgradeable boss lines (keeps basic one-stage creatures)
						// Use when you want to exclude big-evolution bosses (e.g., Galaxyâ€‘Eyes, Utopia lines)
						{
							text: "It can evolve into stronger forms â€” I like upgrade lines",
							excludes: ["1", "1B", "2", "2B", "3", "3B", "4", "4B", "7", "8", "10", "11", "12", "13", "14", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "33", "34", "36", "41", "42", "44", "45", "46", "47", "48", "49", "50", "51", "52", "54", "55", "56", "57", "58", "59", "60", "61", "63", "64", "66", "67", "68", "71", "72", "74", "75", "76", "77", "81", "82", "83", "85", "86", "87", "89", "90", "91", "93", "94", "95", "97", "98", "99", "100"]
						},

						// Removes one-stage/standalone archetypes (keeps evolvable lines)
						// Use when you want to avoid standalone one-off monsters and prefer modular evolutions
						{
							text: "No, it is final â€” I prefer standalone perfect monsters",
							excludes: ["1", "2", "3", "4", "5", "6", "9", "15", "32", "35", "37", "38", "39", "40", "43", "53", "62", "65", "69", "70", "73", "78", "79", "84", "88", "92", "96", "101", "102", "103", "104", "105", "106", "107"]
						}
					]
				},

				{
					ord: 8,
					text: "Do you prefer even or odd numbers?",
					options: [
						// Removes evolvable/upgradeable boss lines (keeps basic one-stage creatures)
						// Use when you want to exclude big-evolution bosses (e.g., Galaxyâ€‘Eyes, Utopia lines)
						{
							text: "Even",
							excludes: ["1B", "3B", "5", "7", "9", "11", "13", "15", "17", "19", "21", "23", "25", "27", "29", "31", "33", "35", "37", "39", "41", "43", "45", "47", "49", "51", "53", "55", "57", "59", "61", "63", "65", "67", "69", "71", "73", "75", "77", "79", "81", "83", "85", "87", "89", "91", "93", "95", "97", "99", "101", "103", "105", "107"]
						},

						// Removes one-stage/standalone archetypes (keeps evolvable lines)
						// Use when you want to avoid standalone one-off monsters and prefer modular evolutions
						{
							text: "Odd",
							excludes: ["2B", "4B", "6", "8", "10", "12", "14", "16", "18", "20", "22", "24", "26", "28", "30", "32", "34", "36", "38", "40", "42", "44", "46", "48", "50", "52", "54", "56", "58", "60", "62", "64", "66", "68", "70", "72", "74", "76", "78", "80", "82", "84", "86", "88", "90", "92", "94", "96", "98", "100", "102", "104", "106"]
						}
					]
				},

				{
					ord: 8,
					text: "Do you prefer themed or standalone monsters?",
					options: [{
							text: "Themed",
							excludes: ["1B", "2B", "3B", "4B", "5", "7", "9", "10", "11", "12", "14", "16", "17", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "32", "34", "35", "36", "41", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "63", "64", "65", "66", "67", "68", "70", "71", "72", "73", "74", "75", "76", "77", "78", "80", "81", "82", "83", "84", "85", "86", "87", "89", "91", "92", "93", "94", "96", "97", "100", "101", "102", "103", "104", "106"]
						},

						{
							text: "Standalone",
							excludes: ["6", "8", "13", "15", "18", "31", "33", "37", "38", "39", "40", "42", "62", "69", "79", "88", "90", "95", "98", "99", "105", "107"]
						}
					]
				}
			];

			/* debug */

			(function simulateFlowWithGetAskOrder() {
				if (!EDIT_MODE) {
					return;
				}
				if (typeof computeRemainingFromAnswersMap !== 'function' || !Array.isArray(QUESTIONS) || !Array.isArray(RESULTS)) {
					console.error('Required globals missing: computeRemainingFromAnswersMap, QUESTIONS, RESULTS');
					return;
				}

				// Obtain askOrder: prefer calling getAskOrder if it exists, otherwise fall back to a simple sequential order
				let askOrder;
				if (typeof getAskOrder === 'function') {
					try {
						askOrder = getAskOrder(); // if accessible this should match your UI order
						if (!Array.isArray(askOrder) || askOrder.length === 0) throw new Error('getAskOrder returned invalid value');
					} catch (e) {
						console.warn('getAskOrder exists but failed; falling back to sequential askOrder:', e);
						askOrder = QUESTIONS.map((_, i) => i);
					}
				} else {
					// getAskOrder not available in this scope â€” reconstruct conservative order (0..N-1)
					askOrder = QUESTIONS.map((_, i) => i);
					console.warn('getAskOrder not found; using fallback sequential askOrder');
				}

				// Helper: copy of your page's questionIsRelevant if present, otherwise assume all questions potentially relevant
				const questionIsRelevantFn = (typeof questionIsRelevant === 'function') ?
					questionIsRelevant :
					((qIdx, answers) => true);

				// findNextAskable that mirrors the UI behaviour but accepts currentAnswers and a startPointer
				function findNextAskableForMap(currentAnswers, startPointer) {
					const n = askOrder.length;
					for (let offset = 0; offset < n; offset++) {
						const p = (startPointer + offset) % n;
						const qIdx = askOrder[p];
						if (currentAnswers.hasOwnProperty(qIdx)) continue;
						if (!questionIsRelevantFn(qIdx, currentAnswers)) continue;
						return p;
					}
					return null;
				}

				const reachable = new Set();
				let terminalPaths = 0;

				// computeRemainingFromAnswersMap must exist in your environment (you used it earlier)
				if (typeof computeRemainingFromAnswersMap !== 'function') {
					console.error('computeRemainingFromAnswersMap not found â€” provide that helper from your page context');
					return;
				}

				function recurse(currentAnswers, startPointer) {
					const nextPointer = findNextAskableForMap(currentAnswers, startPointer);
					if (nextPointer === null) {
						terminalPaths++;
						const remaining = computeRemainingFromAnswersMap(currentAnswers);
						remaining.forEach(r => reachable.add(String(r.id)));
						return;
					}

					const qIdx = askOrder[nextPointer];

					// Determine which options are visible to the user in the UI (same logic you use to hide options)
					const currentPossible = computeRemainingFromAnswersMap(currentAnswers);
					const currentPossibleIds = new Set(currentPossible.map(r => String(r.id)));

					const visibleOpts = [];
					const opts = QUESTIONS[qIdx].options || [];
					for (let i = 0; i < opts.length; i++) {
						const tempAnswers = Object.assign({}, currentAnswers);
						tempAnswers[qIdx] = i;
						const remAfterPick = computeRemainingFromAnswersMap(tempAnswers);
						// Option is visible if it leaves at least one candidate from the current possible set
						const leavesSomething = remAfterPick.some(r => currentPossibleIds.has(String(r.id)));
						if (leavesSomething) visibleOpts.push(i);
					}

					if (visibleOpts.length === 0) {
						terminalPaths++;
						const remaining = computeRemainingFromAnswersMap(currentAnswers);
						remaining.forEach(r => reachable.add(String(r.id)));
						return;
					}

					for (const optIndex of visibleOpts) {
						const newAnswers = Object.assign({}, currentAnswers);
						newAnswers[qIdx] = optIndex;
						recurse(newAnswers, nextPointer + 1);
					}
				}

				recurse({}, 0);

				const allIds = RESULTS.map(r => String(r.id));
				const unreachable = allIds.filter(id => !reachable.has(id)).sort();

				console.log('Ask order used:', askOrder);
				console.log('Terminal UI paths simulated:', terminalPaths);
				console.log('Reachable IDs:', Array.from(reachable).sort());
				console.log('Unreachable IDs:', unreachable);
				return { askOrder, terminalPaths, reachable: Array.from(reachable).sort(), unreachable };
			})();


			/* debug done */

			/* modal/editor state */
			const modal = document.getElementById("modal");
			const modalSave = document.getElementById("modalSave");
			const modalCancel = document.getElementById("modalCancel");
			const resultList = document.getElementById("resultList");
			const modalTitle = document.getElementById("modalTitle");
			const modalSubtitle = document.getElementById("modalSubtitle");
			let editing = { qIndex: null, optIndex: null, tempSet: new Set() };

			const quizArea = document.getElementById("quizArea");
			const modeLabel = document.getElementById("modeLabel");
			const editorPanel = document.getElementById("editorPanel");
			const draggableContainer = document.getElementById("draggableContainer");
			const possibleList = document.getElementById("possibleList");
			const resultArea = document.getElementById("resultArea");
			const resultCard = document.getElementById("resultCard");
			const resultNote = document.getElementById("resultNote");
			const progressText = document.getElementById("progressText");

			modeLabel.innerText = EDIT_MODE ? "Editor" : "Player";
			if (!EDIT_MODE) editorPanel.style.display = "none";
			else editorPanel.style.display = "block";

			/* Runtime state */
			let answers = {}; // map questionIndex -> optionIndex
			// create ask order by sorting a shallow copy by ord numerically
			function getAskOrder() {
				return QUESTIONS
					.map((q, idx) => ({ idx, ord: Number(q.ord) || 0 }))
					.sort((a, b) => a.ord - b.ord)
					.map(x => x.idx);
			}
			let askOrder = getAskOrder();
			let askPointer = 0; // index into askOrder for next question to attempt

			/* Utility: compute remaining RESULTS from a given answers map */
			function computeRemainingFromAnswersMap(ansMap) {
				const excluded = new Set();
				Object.keys(ansMap).forEach(qiStr => {
					const qi = Number(qiStr);
					const optIndex = ansMap[qi];
					if (optIndex === undefined) return;
					const opt = QUESTIONS[qi].options[optIndex];
					(opt.excludes || []).forEach(id => excluded.add(String(id)));
				});
				return RESULTS.filter(r => !excluded.has(String(r.id)));
			}

			/* For editor live preview we show remaining given current answers */
			function renderPossibleList() {
				if (!EDIT_MODE) {
					return;
				}
				const remaining = computeRemainingFromAnswersMap(answers);
				possibleList.innerHTML = "";
				if (remaining.length === 0) {
					const noEl = document.createElement("div");
					noEl.className = "small";
					noEl.innerText = "No possible Numbers remain for current answers.";
					possibleList.appendChild(noEl);
					return;
				}
				remaining.forEach(r => {
					const el = document.createElement("div");
					el.className = "resultCardCompact";
					el.style.padding = "8px";
					el.style.marginBottom = "6px";
					el.innerHTML = `<strong>${r.id}</strong> â€” <span class="small">${r.title}</span>`;
					possibleList.appendChild(el);
				});
			}

			function idsKey(arr) { return arr.map(r => String(r.id)).sort().join("|"); }

			/* Determine if a question is relevant for the current remaining set:
			   A question is relevant if at least one of its options would change the remaining set.
			   For each option, compute remaining after applying that option's excludes on top of current excludes.
			   If all options produce the exact same remaining set (no change), the question is irrelevant and can be skipped.
			*/
			function questionIsRelevant(qIndex, currentAnsMap) {
				if (EDIT_MODE) return true;
				const baseKey = idsKey(computeRemainingFromAnswersMap(currentAnsMap));
				for (let i = 0; i < QUESTIONS[qIndex].options.length; i++) {
					const temp = Object.assign({}, currentAnsMap);
					temp[qIndex] = i;
					const remKey = idsKey(computeRemainingFromAnswersMap(temp));
					if (remKey !== baseKey) return true;
				}
				return false;
			}

			/* Find next askable question index in askOrder starting at askPointer that is unanswered and relevant.
			   Returns null if none found.
			*/
			function findNextAskable(startPointer) {
				const n = askOrder.length;
				for (let offset = 0; offset < n; offset++) {
					const p = (startPointer + offset) % n;
					const qIdx = askOrder[p];
					if (answers[qIdx] !== undefined) continue;
					if (!questionIsRelevant(qIdx, answers)) continue;
					return p;
				}
				return null;
			}

			function renderNextQuestion() {
				quizArea.innerHTML = "";

				const nextPointer = findNextAskable(askPointer);
				if (nextPointer === null) {
					finalizeOrDontKnow();
					return;
				}

				askPointer = nextPointer;
				const qIdx = askOrder[askPointer];
				const q = QUESTIONS[qIdx];

				const qEl = document.createElement("div");
				qEl.className = "question";
				qEl.innerHTML = `<strong>Question ${q.ord + 1}</strong> â€” ${q.text}`;

				const opts = document.createElement("div");
				opts.className = "options";

				// compute current possible IDs (strings) to intersect with option-specific remaining
				const currentPossible = computeRemainingFromAnswersMap(answers);
				const currentPossibleIds = new Set(currentPossible.map(r => String(r.id)));

				// collect visible options: those that do NOT produce 0 remaining AFTER intersecting with current possibles
				const visibleOptions = [];
				q.options.forEach((opt, i) => {
					const temp = Object.assign({}, answers);
					temp[qIdx] = i;
					const remArr = computeRemainingFromAnswersMap(temp);
					// count only ids that are actually in the current possible set
					const intersectCount = remArr.filter(r => currentPossibleIds.has(String(r.id))).length;
					if (intersectCount === 0) return; // skip options that lead to zero possible results within current possibles
					visibleOptions.push({ opt, i, intersectCount, remArr });
				});

				// If no options are visible, finalize as unknown
				if (visibleOptions.length === 0) {
					finalizeOrDontKnow();
					return;
				}

				// Render visible options
				visibleOptions.forEach(({ opt, i }) => {
					const b = document.createElement("div");
					b.className = "opt";
					b.tabIndex = 0;
					b.innerText = opt.text;
					b.addEventListener("click", () => handleSelection(qIdx, i));
					b.addEventListener("keydown", e => { if (e.key === "Enter") handleSelection(qIdx, i); });

					if (EDIT_MODE) {
						const edit = document.createElement("button");
						edit.className = "metaBtn";
						edit.innerText = "Edit Excludes";
						edit.addEventListener("click", ev => {
							ev.stopPropagation();
							openModal(qIdx, i);
						});
						const wrapper = document.createElement("div");
						wrapper.style.display = "flex";
						wrapper.style.gap = "8px";
						wrapper.appendChild(b);
						wrapper.appendChild(edit);
						opts.appendChild(wrapper);
					} else {
						opts.appendChild(b);
					}
				});

				qEl.appendChild(opts);

				if (EDIT_MODE) {
					// optional preview counts for visible options only â€” counts only IDs that are currently possible
					const preview = document.createElement("div");
					preview.className = "small";
					preview.style.marginTop = "8px";
					preview.innerText = "Preview possible remaining counts for each visible option:";
					qEl.appendChild(preview);

					const pgrid = document.createElement("div");
					pgrid.className = "small";
					pgrid.style.marginTop = "6px";
					pgrid.style.display = "grid";
					pgrid.style.gridTemplateColumns = "repeat(2,1fr)";
					pgrid.style.gap = "8px";

					visibleOptions.forEach(({ opt, intersectCount }) => {
						const cell = document.createElement("div");
						cell.innerText = `${opt.text} â€” ${intersectCount} possible`;
						pgrid.appendChild(cell);
					});

					qEl.appendChild(pgrid);
				}

				quizArea.appendChild(qEl);
				renderPossibleList();
			}



			function handleSelection(qIndex, optIndex) {
				answers[qIndex] = optIndex;
				// compute remaining
				const remaining = computeRemainingFromAnswersMap(answers);
				if (remaining.length === 1) {
					showFinalResult(remaining[0]);
					return;
				}
				// try to find the next relevant unanswered question after current askPointer + 1
				const nextPointer = findNextAskable(askPointer + 1);
				if (nextPointer !== null) {
					askPointer = nextPointer;
					renderNextQuestion();
					return;
				}
				// no more relevant questions -> finalize
				finalizeOrDontKnow();
			}

			function updateProgress() {
				const answered = Object.keys(answers).filter(k => answers[k] != null).length;
				progressText.innerText = `${answered} / ${QUESTIONS.length}`;
			}


			/* Show one definitive result */
			function showFinalResult(r) {
				const id = encodeURIComponent(String(r.id));
				window.location = "http://192.168.1.121:8090/index.html?final=" + id;
			}

			/* If exactly 1 remaining -> show it. Else if 0 -> say I don't know. Else say I don't know with candidates. */
			function finalizeOrDontKnow() {
				const remaining = computeRemainingFromAnswersMap(answers);
				if (remaining.length === 1) {
					showFinalResult(remaining[0]);
				} else {
					showDontKnow(remaining);
				}
			}

			/* Show I don't know with remaining candidates */
			function showDontKnow(remaining) {
				if (remaining.length === 0) {
					resultCard.innerHTML = `<strong>I don't know</strong><div class="small">No Numbers remain after those answers.</div>`;
					resultNote.innerText = "";
				} else {
					const html = remaining.map(r => `<div style="margin-bottom:6px"><strong>${r.id}</strong> â€” <span class="small">${r.title}</span></div>`).join("");
					resultCard.innerHTML = `<strong>I don't know</strong>${html}`;
					resultNote.innerText = "Multiple candidates remain; out of questions.";
				}
				resultArea.style.display = "block";
				quizArea.style.display = "none";
				editorPanel.style.display = EDIT_MODE ? "block" : "none";
			}

			/* Modal/editor functions */
			function openModal(qIndex, optIndex) {
				if (!EDIT_MODE) return;
				editing.qIndex = qIndex;
				editing.optIndex = optIndex;
				const existing = QUESTIONS[qIndex].options[optIndex].excludes || [];
				editing.tempSet = new Set(existing.map(String));
				modalTitle.innerText = `Edit Excludes for Option "${QUESTIONS[qIndex].options[optIndex].text}"`;
				modalSubtitle.innerText = "Check Number IDs to exclude when this option is chosen.";
				renderModalList();
				updateSelectedTextarea(); // initialize textarea with current selection
				modal.style.display = "flex";
			}

			// --- Utility: build a global exclude frequency map ---
			function buildExcludeFrequency(excludeQi = null, excludeOptIndex = null) {
				const freq = {};
				QUESTIONS.forEach((q, qi) => {
					q.options.forEach((opt, oi) => {
						if (qi === excludeQi && oi === excludeOptIndex) return; // skip current
						(opt.excludes || []).forEach(id => {
							freq[id] = (freq[id] || 0) + 1;
						});
					});
				});
				return freq;
			}


			function renderModalList() {
				resultList.innerHTML = "";

				// compute current possibles and map to string ids
				const possible = computeRemainingFromAnswersMap(answers);
				const possibleIds = new Set(possible.map(r => String(r.id)));

				// collect excludes from ALL options in this question
				const allExcludesInQuestion = new Set();
				QUESTIONS[editing.qIndex].options.forEach(opt => {
					(opt.excludes || []).forEach(id => allExcludesInQuestion.add(String(id)));
				});

				if (RESULTS.length === 0) {
					const noEl = document.createElement("div");
					noEl.className = "small";
					noEl.innerText = "No Numbers defined in RESULTS.";
					resultList.appendChild(noEl);
					return;
				}

				// iterate through all canonical results
				const excludeFreq = buildExcludeFrequency(editing.qIndex, editing.optIndex);
				RESULTS.forEach(r => {
					const idStr = String(r.id);
					const isPossible = possibleIds.has(idStr);

					const row = document.createElement("div");
					row.className = "resultItem";

					const cb = document.createElement("input");
					cb.type = "checkbox";
					cb.id = "rescb_" + idStr;
					cb.checked = editing.tempSet.has(idStr);
					cb.disabled = false;
					cb.addEventListener("change", () => {
						if (cb.checked) editing.tempSet.add(idStr);
						else editing.tempSet.delete(idStr);
						updateSelectedTextarea();
					});

					const label = document.createElement("label");
					label.htmlFor = cb.id;
					label.textContent = `${r.id} â€” ${r.title}`;

					// Bold + italic if this ID is excluded by ANY option in this question
					if (allExcludesInQuestion.has(idStr)) {
						label.style.fontWeight = "bold";
					}

					// Strike-through if the result exists in RESULTS but is NOT among current possibles
					if (!isPossible) {
						label.style.textDecoration = "line-through";
						label.style.opacity = "0.55";
						// optional tiny note appended for clarity
						const note = document.createElement("span");
						note.className = "small";
						note.style.marginLeft = "8px";
						note.style.color = "var(--muted)";
						note.textContent = "(not possible with current answers)";
						label.appendChild(note);
					}

					// hint for frequently excluded ids
					if ((excludeFreq[idStr] || 0) >= 2) {
						label.title = `Excluded in ${excludeFreq[idStr]} other lists`;
					}

					row.appendChild(cb);
					row.appendChild(label);
					resultList.appendChild(row);
				});
			}




			/*
			// --- NEW: textarea updater ---
			function updateSelectedTextarea() {
				let textarea = document.getElementById("selectedIdsBox");
				if (!textarea) {
					textarea = document.createElement("textarea");
					textarea.id = "selectedIdsBox";
					textarea.rows = 3;
					textarea.style.width = "100%";
					textarea.readOnly = true;
					resultList.parentNode.appendChild(textarea);
				}

				// get the current possible IDs
				const possible = computeRemainingFromAnswersMap(answers).map(r => r.id);

				// only keep selected IDs that are still possible
				const arr = Array.from(editing.tempSet)
					.filter(id => possible.includes(id))
					.sort((a, b) => {
						const na = parseInt(a, 10),
							nb = parseInt(b, 10);
						if (!isNaN(na) && !isNaN(nb)) return na - nb;
						return a.localeCompare(b);
					});

				textarea.value = `["${arr.join('","')}"]`;
			}
			*/

			function updateSelectedTextarea() {
				let textarea = document.getElementById("selectedIdsBox");
				if (!textarea) {
					textarea = document.createElement("textarea");
					textarea.id = "selectedIdsBox";
					textarea.rows = 3;
					textarea.style.width = "100%";
					textarea.readOnly = true;
					// append below the result list (or wherever you want it)
					resultList.parentNode.appendChild(textarea);
				}
				// Format: ["id1","id2","id3"]
				const arr = Array.from(editing.tempSet).sort((a, b) => {
					// numeric sort if possible, but keep string fallback (for "4B")
					const na = parseInt(a, 10),
						nb = parseInt(b, 10);
					if (!isNaN(na) && !isNaN(nb)) return na - nb;
					return a.localeCompare(b);
				});
				textarea.value = `["${arr.join('","')}"]`;
			}



			modalSave.addEventListener("click", () => {
				if (editing.qIndex == null) return;
				const arr = Array.from(editing.tempSet);
				QUESTIONS[editing.qIndex].options[editing.optIndex].excludes = arr;
				closeModal();
				// re-render current to show updated preview counts
				askOrder = getAskOrder();
				// re-render current question (or move forward if current became irrelevant)
				renderNextQuestion();
				renderPossibleList();
			});

			modalCancel.addEventListener("click", () => { closeModal(); });

			function closeModal() {
				modal.style.display = "none";
				editing = { qIndex: null, optIndex: null, tempSet: new Set() };
			}

			/* Initial render */
			askOrder = getAskOrder();
			renderNextQuestion();
			renderPossibleList();

			/* Minimal exposure for console: QUESTIONS will reflect reorder & edits in-memory */
			if (EDIT_MODE) window.Quiz = { RESULTS, QUESTIONS, renderPossibleList };
			else window.Quiz = { RESULTS };

			/* Prevent accidental modal keyboard focus when not editing */
			if (!EDIT_MODE) {
				modal.style.display = "none";
				modal.classList.add("hiddenInPlayer");
			}
		</script>
	</body>
</html>
